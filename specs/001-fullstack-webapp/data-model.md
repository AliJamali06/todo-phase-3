# Data Model: Phase 2 Full-Stack Web Application

**Branch**: `001-fullstack-webapp` | **Date**: 2026-02-07

## Entities

### User

| Field | Type | Constraints | Notes |
|-------|------|------------|-------|
| id | VARCHAR | PK | Generated by Better Auth |
| email | VARCHAR | UNIQUE, NOT NULL | Login identifier |
| name | VARCHAR | nullable | Display name |
| created_at | TIMESTAMP | DEFAULT NOW() | Account creation |

**Relationships**:
- One User has zero or more Tasks (1:N)
- Cascade delete: deleting a User deletes all their Tasks

**Managed by**: Better Auth (the auth library creates and
manages user records; the backend reads but does not write
to the users table directly).

### Task

| Field | Type | Constraints | Notes |
|-------|------|------------|-------|
| id | SERIAL | PK, auto-increment | Task identifier |
| user_id | VARCHAR | FK → users(id), NOT NULL, ON DELETE CASCADE | Owner |
| title | VARCHAR(200) | NOT NULL | Required, max 200 chars |
| description | TEXT | nullable | Optional free text |
| completed | BOOLEAN | DEFAULT FALSE | Completion status |
| created_at | TIMESTAMP | DEFAULT NOW() | Creation time |
| updated_at | TIMESTAMP | DEFAULT NOW() | Last modification |

**Relationships**:
- Each Task belongs to exactly one User (N:1)

**Indexes**:
- `idx_tasks_user_id` on `user_id` — performance for
  listing a user's tasks
- `idx_tasks_completed` on `completed` — performance for
  filtering by status

## Entity Relationship Diagram

```
┌──────────────┐       1:N       ┌──────────────────┐
│    User      │────────────────>│      Task        │
│──────────────│                 │──────────────────│
│ id (PK)      │                 │ id (PK)          │
│ email (UQ)   │                 │ user_id (FK)     │
│ name         │                 │ title            │
│ created_at   │                 │ description      │
└──────────────┘                 │ completed        │
                                 │ created_at       │
                                 │ updated_at       │
                                 └──────────────────┘
```

## Validation Rules

### User
- `email`: MUST be valid email format; MUST be unique
- `name`: Optional; displayed in UI header
- `id`: Generated by Better Auth; not user-editable

### Task
- `title`: MUST NOT be empty; MUST NOT exceed 200 characters
- `description`: Optional; no length limit
- `completed`: Boolean toggle; defaults to false
- `user_id`: MUST match the authenticated user's ID
  (enforced by backend middleware, not by user input)
- `updated_at`: MUST be updated on every modification

## State Transitions

### Task Completion State

```
┌──────────────┐   toggle    ┌──────────────┐
│  incomplete  │<───────────>│   complete   │
│ completed=F  │             │ completed=T  │
└──────────────┘             └──────────────┘
```

- Tasks start as incomplete (`completed = false`)
- PATCH endpoint toggles between complete/incomplete
- No additional states (no "in progress", "archived", etc.)

## Data Access Patterns

| Operation | Query Pattern | Index Used |
|-----------|--------------|-----------|
| List user's tasks | `WHERE user_id = ? ORDER BY created_at DESC` | idx_tasks_user_id |
| Get single task | `WHERE id = ? AND user_id = ?` | PK + idx_tasks_user_id |
| Create task | `INSERT INTO tasks (user_id, title, ...)` | N/A |
| Update task | `UPDATE tasks SET ... WHERE id = ? AND user_id = ?` | PK + idx_tasks_user_id |
| Delete task | `DELETE FROM tasks WHERE id = ? AND user_id = ?` | PK + idx_tasks_user_id |
| Toggle complete | `UPDATE tasks SET completed = NOT completed WHERE id = ? AND user_id = ?` | PK + idx_tasks_user_id |

**Note**: Every query includes `user_id = ?` to enforce data
isolation. This is the primary security mechanism preventing
users from accessing other users' tasks.
